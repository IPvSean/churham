<!DOCTYPE html>
<html>
  <body>
    <p><strong>Test by Sean</p>
    <p id="runner"></p>
    <script type="text/javascript">
    var addToObject = function (obj, key, value, index) {

      // Create a temp object and index variable
      var temp = {};
      var i = 0;

      // Loop through the original object
      for (var prop in obj) {
        if (obj.hasOwnProperty(prop)) {

          // If the indexes match, add the new item
          if (i === index && key && value) {
            temp[key] = value;
          }

          // Add the current item in the loop to the temp obj
          temp[prop] = obj[prop];

          // Increase the count
          i++;

        }
      }

      // If no index, add to the end
      if (!index && key && value) {
        temp[key] = value;
      }

      return temp;

    };
    </script>


    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
    <script type="text/javascript">
      var public_spreadsheet_url = 'https://cors-anywhere.herokuapp.com/https://docs.google.com/spreadsheets/d/e/2PACX-1vRtZjJ2AWaJr8JZc0L9Pq7x9k9FAT950h5Pi7Mj_WmjrSU1OzwN26DmCGvCyibBGj8Q4lu9i9nZl7HQ/pub?gid=1804680163&single=true&output=csv';

      function init() {
        Papa.parse(public_spreadsheet_url, {
          download: true,
          header: true,
          complete: showInfo
        })
      }

      window.addEventListener('DOMContentLoaded', init)
      const full_output = {};
      function showInfo(results) {
        var data = results.data

        // data comes through as a simple array since simpleSheet is turned on
        // alert("Successfully processed " + data.length + " rows!")
        // document.getElementById("runner").innerHTML = "<strong>Runner:</strong> " + [ data[0]['PAX name'], data[1]['PAX name'] ].join(", ");
        for (var pax of data)
        {
          var full_output = addToObject(full_output, pax['PAX name'] + " " + pax['Best time for 13.1 miles'] + " " + pax['Age'] + pax['Team Name'] + "<br />");
        }
        console.log(data);
        document.getElementById("runner").innerHTML = full_output;
      }

    </script>

  </body>
</html>
